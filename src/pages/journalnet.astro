---
import BaseLayout from "../layouts/BaseLayout.astro";
---

<BaseLayout
  title="JournalNet â€” Journal Foundation"
  description="A network where privacy is default. Apps don't own your data."
>
  <main class="journalnet-page">
    
    <section class="hero">
      <div class="container">
        <h1>JournalNet</h1>
        <p class="definition">
          A network where apps request access to data they don't host.
        </p>
      </div>
    </section>

    <section class="network-viz">
      <div class="container">
        <div id="graph-container"></div>
        <div class="graph-legend">
          <span class="legend-item">
            <span class="dot vault"></span> Vaults (user-controlled storage)
          </span>
          <span class="legend-item">
            <span class="dot app"></span> Apps (request capabilities)
          </span>
          <span class="legend-item">
            <span class="dot relay"></span> Blind relays (metadata protection)
          </span>
        </div>
      </div>
    </section>

    <section class="explainer">
      <div class="container">
        <div class="explainer-grid">
          <div>
            <h2>Vaults</h2>
            <p>Encrypted storage. You control it.</p>
          </div>
          <div>
            <h2>Capabilities</h2>
            <p>Temporary, scoped, revocable access tokens.</p>
          </div>
          <div>
            <h2>Apps</h2>
            <p>Swappable interfaces. Data stays in your vault.</p>
          </div>
        </div>
      </div>
    </section>

    <section class="principles">
      <div class="container">
        <h2>Three Principles</h2>
        <ol>
          <li>Apps don't custody your data</li>
          <li>Metadata is minimized by default</li>
          <li>Access is capability-based, not credential-based</li>
        </ol>
      </div>
    </section>

    <section class="cta">
      <div class="container">
        <h2>Build on JournalNet</h2>
        <div class="cta-actions">
          <a href="/stack" class="btn btn--primary">See the protocol stack</a>
          <a href="/docs" class="btn btn--secondary">Start building</a>
        </div>
      </div>
    </section>

  </main>
</BaseLayout>

<script>
  import ForceGraph from 'force-graph';

  const container = document.getElementById('graph-container');
  if (container) {
    
    // Generate network data
    const numVaults = 8;
    const numApps = 5;
    const numRelays = 3;
    
    const vaults = Array.from({length: numVaults}, (_, i) => ({
      id: `vault-${i}`,
      type: 'vault',
      label: `Vault ${i + 1}`
    }));
    
    const apps = Array.from({length: numApps}, (_, i) => ({
      id: `app-${i}`,
      type: 'app',
      label: `App ${i + 1}`
    }));
    
    const relays = Array.from({length: numRelays}, (_, i) => ({
      id: `relay-${i}`,
      type: 'relay',
      label: `Relay ${i + 1}`
    }));
    
    const nodes = [...vaults, ...apps, ...relays];
    
    // Create connections: apps -> relays -> vaults
    const links = [];
    
    apps.forEach(app => {
      // Each app connects to 1-2 relays
      const numRelayConnections = Math.floor(Math.random() * 2) + 1;
      const connectedRelays = relays
        .sort(() => Math.random() - 0.5)
        .slice(0, numRelayConnections);
      
      connectedRelays.forEach(relay => {
        links.push({
          source: app.id,
          target: relay.id
        });
      });
    });
    
    relays.forEach(relay => {
      // Each relay connects to 2-4 vaults
      const numVaultConnections = Math.floor(Math.random() * 3) + 2;
      const connectedVaults = vaults
        .sort(() => Math.random() - 0.5)
        .slice(0, numVaultConnections);
      
      connectedVaults.forEach(vault => {
        links.push({
          source: relay.id,
          target: vault.id
        });
      });
    });
    
    const data = { nodes, links };
    
    const Graph = ForceGraph()(container)
      .graphData(data)
      .nodeLabel('label')
      .nodeColor(node => {
        if (node.type === 'vault') return '#0dd280';
        if (node.type === 'app') return '#2d7dff';
        if (node.type === 'relay') return '#f5b400';
        return '#666';
      })
      .nodeRelSize(6)
      .linkColor(() => 'rgba(255, 255, 255, 0.15)')
      .linkWidth(2)
      .backgroundColor('#05070a')
      .width(container.clientWidth)
      .height(500);
  }
</script>

<style>
  .journalnet-page {
    padding-bottom: var(--space-3xl);
  }

  .hero {
    padding: var(--space-3xl) 0 var(--space-2xl);
    text-align: center;
  }

  .hero h1 {
    margin-bottom: var(--space-md);
  }

  .definition {
    font-size: var(--step-1);
    color: var(--color-text-secondary);
    max-width: 60ch;
    margin: 0 auto;
  }

  .network-viz {
    padding: var(--space-2xl) 0;
    background: rgba(17, 24, 33, 0.35);
  }

  #graph-container {
    width: 100%;
    height: 500px;
    border-radius: var(--radius-lg);
    overflow: hidden;
    background: var(--color-surface-void);
    border: 1px solid var(--color-border-subtle);
  }

  .graph-legend {
    display: flex;
    gap: var(--space-lg);
    justify-content: center;
    margin-top: var(--space-md);
    flex-wrap: wrap;
  }

  .legend-item {
    display: flex;
    align-items: center;
    gap: var(--space-2xs);
    color: var(--color-text-secondary);
    font-size: var(--step--1);
  }

  .dot {
    width: 12px;
    height: 12px;
    border-radius: 50%;
  }

  .dot.vault {
    background: #0dd280;
  }

  .dot.app {
    background: #2d7dff;
  }

  .dot.relay {
    background: #f5b400;
  }

  .explainer {
    padding: var(--space-3xl) 0;
  }

  .explainer-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: var(--space-xl);
    text-align: center;
  }

  .explainer-grid h2 {
    margin-bottom: var(--space-xs);
    font-size: var(--step-1);
  }

  .explainer-grid p {
    color: var(--color-text-secondary);
    margin: 0;
  }

  .principles {
    padding: var(--space-3xl) 0;
    background: rgba(17, 24, 33, 0.35);
  }

  .principles h2 {
    text-align: center;
    margin-bottom: var(--space-xl);
  }

  .principles ol {
    max-width: 60ch;
    margin: 0 auto;
    font-size: var(--step-0);
    line-height: 2;
    color: var(--color-text-secondary);
  }

  .cta {
    padding: var(--space-3xl) 0;
    text-align: center;
  }

  .cta h2 {
    margin-bottom: var(--space-lg);
  }

  .cta-actions {
    display: flex;
    gap: var(--space-sm);
    justify-content: center;
    flex-wrap: wrap;
  }

  .cta-actions .btn {
    min-width: 200px;
  }
</style>