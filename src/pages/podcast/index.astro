---
import { getCollection } from 'astro:content';
import BaseLayout from '../../layouts/BaseLayout.astro';
import { formatDate } from '../../utils/date';

const allEpisodes = (await getCollection('podcast'))
  .sort((a, b) => b.data.episode - a.data.episode);
---

<BaseLayout 
  title="Podcast ‚Äî Journal Foundation"
  description="Deep conversations about privacy, security, digital sovereignty, and building the post-surveillance web."
>
  <div class="container prose" style="margin-top: var(--space-xl); margin-bottom: var(--space-3xl);">
    <header style="text-align: center; margin-bottom: var(--space-xl);">
      <h1>The Journal Foundation Podcast</h1>
      <p class="lead">Deep conversations about privacy, security, digital sovereignty, and building the post-surveillance web.</p>
      
      <div class="subscribe-actions">
        <a href="/podcast/feed.xml" class="btn btn--primary">üì° RSS Feed</a>
        <a href="#" class="btn btn--secondary">üéµ Apple Podcasts</a>
        <a href="#" class="btn btn--secondary">‚ñ∂Ô∏è Spotify</a>
      </div>
    </header>
    
    {allEpisodes.length === 0 ? (
      <div style="text-align: center; padding: var(--space-3xl) 0;">
        <p style="color: var(--text-muted); font-size: 1.125rem;">Episodes coming soon. The first episode will explain why Cipherlots exist and what makes them different.</p>
      </div>
    ) : (
      <div class="episodes-grid">
        {allEpisodes.map((episode) => (
          <article class="episode-card card">
            <header>
              <div class="episode-header">
                <span class="episode-number">Episode {episode.data.episode}</span>
                <span class="episode-duration">{episode.data.duration}</span>
              </div>
              
              <h2>
                <a href={`/podcast/${episode.slug}`}>{episode.data.title}</a>
              </h2>
              
              <div class="episode-meta">
                <time datetime={episode.data.date.toISOString()}>
                  {formatDate(episode.data.date)}
                </time>
              </div>
            </header>
            
            <div class="episode-description">
              <p>{episode.data.description}</p>
            </div>
            
            <footer class="episode-actions">
              <a href={`/podcast/${episode.slug}`} class="btn btn--primary listen-button">
                üéß Listen & Read Notes
              </a>
              {episode.data.audioFile && (
                <a href={episode.data.audioFile} class="btn btn--secondary download-button">
                  ‚¨áÔ∏è Download MP3
                </a>
              )}
            </footer>
          </article>
        ))}
      </div>
    )}
    
    <div style="background: var(--void-lighter); padding: var(--space-lg); border-radius: 8px; margin-top: var(--space-3xl);">
      <h3>About the Podcast</h3>
      <p>This podcast explores the technical, philosophical, and practical aspects of building privacy infrastructure. We dive deep into:</p>
      
      <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: var(--space-md); margin-top: var(--space-md);">
        <div>
          <h4>üîí Privacy Technology</h4>
          <p>How encryption, metadata minimization, and capability-based sharing actually work.</p>
        </div>
        
        <div>
          <h4>üèõÔ∏è Digital Sovereignty</h4>
          <p>What it means to control your digital life and why it matters for democracy.</p>
        </div>
        
        <div>
          <h4>üõ†Ô∏è Building Infrastructure</h4>
          <p>The technical and social challenges of creating alternatives to surveillance capitalism.</p>
        </div>
        
        <div>
          <h4>üéØ Practical Implementation</h4>
          <p>Real-world deployment, security considerations, and lessons learned.</p>
        </div>
      </div>
    </div>
    
    <div class="podcast-callout">
      <h3>Suggest Topics or Guests</h3>
      <p>Have ideas for podcast topics or guests who should share their expertise on privacy infrastructure?</p>
      <div class="podcast-callout__actions">
        <a href="/contact" class="btn btn--primary">Get in Touch</a>
      </div>
    </div>
  </div>
</BaseLayout>

<style>
  .lead {
    font-size: 1.25rem;
    color: var(--text-secondary);
    max-width: 700px;
    margin: 0 auto;
  }
  
  .subscribe-actions {
    display: flex;
    gap: var(--space-sm);
    justify-content: center;
    flex-wrap: wrap;
    margin-top: var(--space-lg);
  }

  .subscribe-actions .btn {
    min-width: min(220px, 100%);
  }
  
  .episodes-grid {
    display: grid;
    gap: var(--space-xl);
    margin-top: var(--space-xl);
  }

  .episode-card {
    gap: var(--space-sm);
    transition: border-color var(--duration-base) var(--easing-standard),
      background-color var(--duration-base) var(--easing-standard);
  }

  .episode-card:hover {
    border-color: rgba(45, 125, 255, 0.35);
    background: rgba(45, 125, 255, 0.08);
  }
  
  .episode-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: var(--space-sm);
  }
  
  .episode-number {
    font-family: var(--font-mono);
    color: var(--electric-blue);
    font-size: 0.875rem;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.05em;
  }
  
  .episode-duration {
    color: var(--text-muted);
    font-size: 0.875rem;
    font-family: var(--font-mono);
  }
  
  .episode-card h2 {
    margin-bottom: var(--space-sm);
    font-size: 1.5rem;
  }
  
  .episode-card h2 a {
    color: var(--color-text-primary);
    text-decoration: none;
  }

  .episode-card h2 a:hover {
    color: var(--color-accent-emerald);
  }
  
  .episode-meta {
    color: var(--text-muted);
    font-size: 0.875rem;
    margin-bottom: var(--space-md);
  }
  
  .episode-description {
    margin-bottom: var(--space-lg);
  }
  
  .episode-description p {
    color: var(--text-secondary);
    line-height: 1.6;
    margin-bottom: 0;
  }
  
  .episode-actions {
    display: flex;
    gap: var(--space-sm);
    flex-wrap: wrap;
  }

  .episode-actions .btn {
    flex: 1 1 220px;
    justify-content: center;
    gap: var(--space-3xs);
  }
  
  h3 {
    color: var(--color-text-primary);
    margin-bottom: var(--space-sm);
  }
  
  h4 {
    color: var(--color-accent-azure);
    margin-bottom: var(--space-xs);
    font-size: 1rem;
  }

  .podcast-callout {
    background: linear-gradient(135deg, rgba(13, 210, 128, 0.12), rgba(45, 125, 255, 0.12));
    border: 1px solid rgba(45, 125, 255, 0.35);
    border-radius: var(--radius-lg);
    padding: var(--space-lg);
    margin-top: var(--space-xl);
    text-align: center;
    box-shadow: var(--shadow-sm);
  }

  .podcast-callout__actions {
    margin-top: var(--space-md);
  }

  .podcast-callout__actions .btn {
    min-width: min(240px, 100%);
  }
</style>